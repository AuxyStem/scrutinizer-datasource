{"version":3,"sources":["../src/datasource.js"],"names":["_","ScrutinizerJSON","Handledata","reportTypes","reportDirection","makescrutJSON","dataHandler","GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","$http","type","url","authToken","jsonData","name","q","http","reportOptions","reportDirections","withCredentials","liveQuery","headers","basicAuth","length","runReport","exporters","filters","options","k","datatoGraph","query","buildQueryParameters","targets","filter","t","hide","target","undefined","when","data","getAdhocFilters","adhocFilters","checkStart","reportInterface","reportType","Promise","resolve","reject","j","intervalTime","findtimeJSON","unix","reportFilters","doRequest","method","params","then","selectedInterval","response","dataGranularity","used","scrutinizerJSON","reportJSON","scrutDirection","formatedData","formatData","push","concat","apply","rm","status","message","title","scope","selectedIP","ctrl","action","view","session_state","client_time_zone","order_by","search","column","value","comparison","filterType","_key","query_limit","offset","max_num_rows","hostDisplayType","text","l","rows","filterDrag","searchStr","label","refresh","refId","exporterList","i","result","map","d","isObject","datasourceRequest","replace","scopedVars","report","direction","interface"],"mappings":";;;;;;;;;;;;;;;AAAOA,O;;AACEC,qB,eAAAA,e;AAAiBC,gB,eAAAA,U;;AACjBC,iB,gBAAAA,W;AAAaC,qB,gBAAAA,e;;;;;;;;;;;;;;;;;;;;;AAElBC,mB,GAAgB,IAAIJ,eAAJ,E;AAChBK,iB,GAAc,IAAIJ,UAAJ,E;;mCAELK,iB;AACX,mCAAYC,gBAAZ,EAA8BC,EAA9B,EAAkCC,UAAlC,EAA8CC,WAA9C,EAA2DC,KAA3D,EAAkE;AAAA;;AAChE,eAAKC,IAAL,GAAYL,iBAAiBK,IAA7B;AACA,eAAKC,GAAL,GAAWN,iBAAiBM,GAAjB,GAAuB,uBAAlC;AACA,eAAKC,SAAL,GAAiBP,iBAAiBQ,QAAjB,CAA0B,gBAA1B,CAAjB;AACA,eAAKC,IAAL,GAAYT,iBAAiBS,IAA7B;AACA,eAAKC,CAAL,GAAST,EAAT;AACA,eAAKU,IAAL,GAAYP,KAAZ;AACA,eAAKF,UAAL,GAAkBA,UAAlB;AACA,eAAKC,WAAL,GAAmBA,WAAnB;AACA,eAAKS,aAAL,GAAqBjB,WAArB;AACA,eAAKkB,gBAAL,GAAwBjB,eAAxB;AACA,eAAKkB,eAAL,GAAuBd,iBAAiBc,eAAxC;AACA,eAAKC,SAAL,GAAiB,EAAjB;AACA,eAAKC,OAAL,GAAe,EAAE,gBAAgB,kBAAlB,EAAf;AACA,cACE,OAAOhB,iBAAiBiB,SAAxB,KAAsC,QAAtC,IACAjB,iBAAiBiB,SAAjB,CAA2BC,MAA3B,GAAoC,CAFtC,EAGE;AACA,iBAAKF,OAAL,CAAa,eAAb,IAAgChB,iBAAiBiB,SAAjD;AACD;AACD,eAAKE,SAAL,GAAiB,KAAjB;;AAEA,eAAKC,SAAL,GAAiB,EAAjB;;AAEA,eAAKC,OAAL,GAAe,EAAf;AACD;;;;gCAEKC,O,EAAS;AAAA;;AACb,gBAAIC,IAAI,CAAR;AACA,gBAAIC,cAAc,EAAlB;;AAEA,iBAAKL,SAAL,GAAiB,KAAjB;;AAEA,gBAAIM,QAAQ,KAAKC,oBAAL,CAA0BJ,OAA1B,CAAZ;;AAEA,iBAAKP,SAAL,GAAiBU,KAAjB;AACAA,kBAAME,OAAN,GAAgBF,MAAME,OAAN,CAAcC,MAAd,CAAqB;AAAA,qBAAK,CAACC,EAAEC,IAAR;AAAA,aAArB,CAAhB;;AAEA,gBAAIL,MAAME,OAAN,CAAc,CAAd,EAAiBI,MAAjB,KAA4BC,SAAhC,EAA2C;AACzC,qBAAO,KAAKtB,CAAL,CAAOuB,IAAP,CAAY,EAAEC,MAAM,EAAR,EAAZ,CAAP;AACD;;AAED,gBAAI,KAAK/B,WAAL,CAAiBgC,eAArB,EAAsC;AACpCV,oBAAMW,YAAN,GAAqB,KAAKjC,WAAL,CAAiBgC,eAAjB,CAAiC,KAAK1B,IAAtC,CAArB;AACD,aAFD,MAEO;AACLgB,oBAAMW,YAAN,GAAqB,EAArB;AACD;;AAED,gBAAIC,aAAaZ,MAAME,OAAN,CAAcT,MAAd,GAAuB,CAAxC;AACA;AACA,gBACE,CAACO,MAAME,OAAN,CAAcU,UAAd,EAA0BN,MAA1B,KAAqCC,SAArC,IAAkD,iBAAnD,KACAP,MAAME,OAAN,CAAcU,UAAd,EAA0BC,eAA1B,KAA8C,kBAD9C,IAEAb,MAAME,OAAN,CAAcU,UAAd,EAA0BzC,eAA1B,KAA8C,kBAF9C,IAGA6B,MAAME,OAAN,CAAcU,UAAd,EAA0BE,UAA1B,KAAyC,eAJ3C,EAKE;AACA,mBAAKpB,SAAL,GAAiB,IAAjB;AACD;AACD;AACA,gBAAI,KAAKA,SAAL,IAAkB,IAAtB,EAA4B;AAC1B,qBAAO,IAAIqB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAAA,2CAC7BC,CAD6B;AAEpC,sBAAIC,eAAe/C,cAAcgD,YAAd,CACjB,MAAKtC,SADY,EAEjBkB,MAAME,OAAN,CAAcgB,CAAd,EAAiBJ,UAFA,EAEY;AAC7BjB,0BAAQ,OAAR,EAAiB,MAAjB,EAAyBwB,IAAzB,EAHiB,EAGgB;AACjCxB,0BAAQ,OAAR,EAAiB,IAAjB,EAAuBwB,IAAvB,EAJiB,EAIc;AAC/BrB,wBAAME,OAAN,CAAcgB,CAAd,EAAiBZ,MALA,EAKQ;AACzBN,wBAAME,OAAN,CAAcgB,CAAd,EAAiB/C,eANA,EAMiB;AAClC6B,wBAAME,OAAN,CAAcgB,CAAd,EAAiBL,eAPA,EAOiB;AAClCb,wBAAME,OAAN,CAAcgB,CAAd,EAAiBI,aARA,CAAnB;;AAWA,wBAAKC,SAAL,CAAe;AACb1C,8BAAQ,MAAKA,GADA;AAEb2C,4BAAQ,KAFK;AAGbC,4BAAQN;AAHK,mBAAf,EAIGO,IAJH,CAIQ,oBAAY;AAClB,wBAAIC,mBACFC,SAASnB,IAAT,CAAc,eAAd,EAA+BoB,eAA/B,CAA+CC,IADjD;;AAGA,wBAAIC,kBAAkB3D,cAAc4D,UAAd,CACpB,MAAKlD,SADe,EAEpBkB,MAAME,OAAN,CAAcgB,CAAd,EAAiBJ,UAFG,EAES;AAC7BjB,4BAAQ,OAAR,EAAiB,MAAjB,EAAyBwB,IAAzB,EAHoB,EAGa;AACjCxB,4BAAQ,OAAR,EAAiB,IAAjB,EAAuBwB,IAAvB,EAJoB,EAIW;AAC/BrB,0BAAME,OAAN,CAAcgB,CAAd,EAAiBZ,MALG,EAKK;AACzBN,0BAAME,OAAN,CAAcgB,CAAd,EAAiB/C,eANG,EAMc;AAClC6B,0BAAME,OAAN,CAAcgB,CAAd,EAAiBL,eAPG,EAOc;AAClCb,0BAAME,OAAN,CAAcgB,CAAd,EAAiBI,aARG,CAAtB;;AAWA,wBAAIW,iBAAiBjC,MAAME,OAAN,CAAcgB,CAAd,EAAiB/C,eAAtC;;AAEA,0BAAKoD,SAAL,CAAe;AACb1C,gCAAQ,MAAKA,GADA;AAEb2C,8BAAQ,KAFK;AAGbC,8BAAQM;AAHK,qBAAf,EAIGL,IAJH,CAIQ,oBAAY;AAClB,0BAAIQ,eAAe7D,YAAY8D,UAAZ,CACjBP,SAASnB,IADQ,EAEjBwB,cAFiB,EAGjBN,gBAHiB,CAAnB;;AAMA5B,kCAAYqC,IAAZ,CAAiBF,YAAjB;AACAnC,oCAAc,GAAGsC,MAAH,CAAUC,KAAV,CAAgB,EAAhB,EAAoBvC,WAApB,CAAd;;AAEAD;AACA;AACA,0BAAIA,MAAME,MAAME,OAAN,CAAcT,MAAxB,EAAgC;AAC9B,+BAAOuB,QAAQ,EAAEP,MAAMV,WAAR,EAAR,CAAP;AACD;AACF,qBAnBD;AAoBD,mBAzCD;AAboC;;AACtC,qBAAK,IAAImB,IAAI,CAAb,EAAgBA,IAAIlB,MAAME,OAAN,CAAcT,MAAlC,EAA0CyB,GAA1C,EAA+C;AAAA,wBAAtCA,CAAsC;AAsD9C;AACF,eAxDM,CAAP;AAyDD;AACF;;;2CAEgB;AACf,mBAAO,KAAKK,SAAL,CAAe;AACpB1C,wBAAQ,KAAKA,GADO;AAEpB2C,sBAAQ,KAFY;AAGpBC,sBAAQ;AACNc,oBAAI,WADE;AAENzD,gCAAc,KAAKA;AAFb;AAHY,aAAf,EAOJ4C,IAPI,CAOC,oBAAY;AAClB,kBAAIE,SAASY,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,uBAAO;AACLA,0BAAQ,SADH;AAELC,2BAAS,wBAFJ;AAGLC,yBAAO;AAHF,iBAAP;AAKD;AACF,aAfM,CAAP;AAgBD;;;yCAEc7C,O,EAAS8C,K,EAAO;AAC7B,gBAAI3C,QAAQ,KAAKV,SAAjB;;AAEA,gBAAIU,MAAME,OAAN,CAAc,CAAd,EAAiBI,MAAjB,IAA2BC,SAA/B,EAA0C;AACxC;AACA,kBAAIqC,aAAaD,MAAME,IAAN,CAAWvC,MAAX,CAAkBA,MAAnC;AACA,qBAAO,KAAKiB,SAAL,CAAe;AACpB1C,0BAAQ,KAAKA,GADO;AAEpB2C,wBAAQ,KAFY;AAGpBC,wBAAQ;AACNc,sBAAI,QADE;AAENO,0BAAQ,KAFF;AAGNC,wBAAM,eAHA;AAINjE,kCAAc,KAAKA,SAJb;AAKNkE,iCAAe;AACbC,sCAAkB,kBADL;AAEbC,8BAAU,EAFG;AAGbC,4BAAQ,CACN;AACEC,8BAAQ,iBADV;AAEEC,kCAAUT,UAFZ;AAGEU,kCAAY,MAHd;AAIE7C,4BAAM,EAAE8C,YAAY,cAAd,EAJR;AAKEC,sDAA8BZ;AALhC,qBADM,CAHK;AAYba,iCAAa,EAAEC,QAAQ,CAAV,EAAaC,cAAc,EAA3B,EAZA;AAabC,qCAAiB;AAbJ;AALT;AAHY,eAAf,EAwBJlC,IAxBI,CAwBC,oBAAY;AAClB,oBAAIjB,OAAO,CAAC,EAAEoD,MAAM,gBAAR,EAA0BR,OAAO,eAAjC,EAAD,CAAX;AACA,oBAAIS,IAAI,CAAR;AACA,oBAAI/E,WAAW6C,SAASnB,IAAxB;AACA,qBAAKqD,IAAI,CAAT,EAAYA,IAAI/E,SAASgF,IAAT,CAActE,MAA9B,EAAsCqE,GAAtC,EAA2C;AACzCrD,uBAAK2B,IAAL,CAAU;AACRiB,2BAAOtE,SAASgF,IAAT,CAAcD,CAAd,EAAiB,CAAjB,EAAoBE,UAApB,CAA+BC,SAD9B;AAERJ,0BAAM9E,SAASgF,IAAT,CAAcD,CAAd,EAAiB,CAAjB,EAAoBI;AAFlB,mBAAV;AAID;;AAED,uBAAOzD,IAAP;AACD,eApCM,CAAP;AAqCD;AACF;;;sCAEWkC,K,EAAOwB,O,EAAS;AAC1B,iBAAKvE,OAAL,GAAe+C,MAAME,IAAN,CAAWvC,MAAX,CAAkBV,OAAjC;AACAuE,oBAAQA,OAAR;AACD;;;uCAEYnE,K,EAAO2C,K,EAAO;AAAA;;AACzB,gBAAIA,MAAME,IAAN,CAAWvC,MAAX,CAAkB8D,KAAlB,KAA4B,GAA5B,IAAmCpE,UAAU,EAAjD,EAAqD;AACnD,qBAAO,KAAKuB,SAAL,CAAe;AACpB1C,0BAAQ,KAAKA,GADO;AAEpB2C,wBAAQ,KAFY;AAGpBC,wBAAQ;AACNc,sBAAI,mBADE;AAEN3D,wBAAM,SAFA;AAGNE,kCAAc,KAAKA;AAHb;AAHY,eAAf,EAQJ4C,IARI,CAQC,oBAAY;AAClB,oBAAI2C,eAAe,CAAC,EAAER,MAAM,eAAR,EAAyBR,OAAO,cAAhC,EAAD,CAAnB;AACA,qBAAK,IAAIiB,IAAI,CAAb,EAAgBA,IAAI1C,SAASnB,IAAT,CAAchB,MAAlC,EAA0C6E,GAA1C,EAA+C;AAC7CD,+BAAajC,IAAb,CAAkB;AAChByB,0BAAMjC,SAASnB,IAAT,CAAc6D,CAAd,EAAiB,MAAjB,CADU;AAEhBjB,2BAAOzB,SAASnB,IAAT,CAAc6D,CAAd,EAAiB,IAAjB;AAFS,mBAAlB;AAID;;AAED,uBAAK3E,SAAL,GAAiB0E,YAAjB;AACA,uBAAOA,YAAP;AACD,eAnBM,CAAP;AAoBD,aArBD,MAqBO;AACL,qBAAO,KAAK1E,SAAZ;AACD;AACF;;;yCAEc4E,M,EAAQ;AACrB,mBAAOxG,EAAEyG,GAAF,CAAMD,OAAO9D,IAAb,EAAmB,UAACgE,CAAD,EAAIH,CAAJ,EAAU;AAClC,kBAAIG,KAAKA,EAAEZ,IAAP,IAAeY,EAAEpB,KAArB,EAA4B;AAC1B,uBAAO,EAAEQ,MAAMY,EAAEZ,IAAV,EAAgBR,OAAOoB,EAAEpB,KAAzB,EAAP;AACD,eAFD,MAEO,IAAItF,EAAE2G,QAAF,CAAWD,CAAX,CAAJ,EAAmB;AACxB,uBAAO,EAAEZ,MAAMY,CAAR,EAAWpB,OAAOiB,CAAlB,EAAP;AACD;;AAED,qBAAO,EAAET,MAAMY,CAAR,EAAWpB,OAAOoB,CAAlB,EAAP;AACD,aARM,CAAP;AASD;;;oCAES5E,O,EAAS;AACjBA,oBAAQR,eAAR,GAA0B,KAAKA,eAA/B;AACAQ,oBAAQN,OAAR,GAAkB,KAAKA,OAAvB;;AAEA,mBAAO,KAAKd,UAAL,CAAgBkG,iBAAhB,CAAkC9E,OAAlC,CAAP;AACD;;;+CAEoBA,O,EAAS;AAAA;;AAC5BA,oBAAQK,OAAR,GAAkBnC,EAAEoC,MAAF,CAASN,QAAQK,OAAjB,EAA0B,kBAAU;AACpD,qBAAOI,OAAOA,MAAP,KAAkB,eAAzB;AACD,aAFiB,CAAlB;;AAIA,gBAAIJ,UAAUnC,EAAEyG,GAAF,CAAM3E,QAAQK,OAAd,EAAuB,kBAAU;AAC7C,qBAAO;AACLI,wBAAQ,OAAK5B,WAAL,CAAiBkG,OAAjB,CACNtE,OAAOA,MADD,EAENT,QAAQgF,UAFF,EAGN,OAHM,CADH;AAMLT,uBAAO9D,OAAO8D,KANT;AAOL/D,sBAAMC,OAAOD,IAPR;AAQLzB,sBAAM0B,OAAO1B,IAAP,IAAe,WARhB;;AAULkC,4BAAY,OAAKpC,WAAL,CAAiBkG,OAAjB,CACVtE,OAAOwE,MADG,EAEVjF,QAAQgF,UAFE,EAGV,OAHU,CAVP;;AAgBL1G,iCAAiB,OAAKO,WAAL,CAAiBkG,OAAjB,CACftE,OAAOyE,SADQ,EAEflF,QAAQgF,UAFO,EAGf,OAHe,CAhBZ;;AAsBLhE,iCAAiB,OAAKnC,WAAL,CAAiBkG,OAAjB,CACftE,OAAO0E,SAAP,IAAoB,kBADL,EAEfnF,QAAQgF,UAFO,EAGf,OAHe,CAtBZ;;AA4BLvD,+BAAe,OAAK5C,WAAL,CAAiBkG,OAAjB,CACbtE,OAAOV,OAAP,IAAkB,WADL,EAEbC,QAAQgF,UAFK,EAGb,OAHa;AA5BV,eAAP;AAkCD,aAnCa,CAAd;;AAqCAhF,oBAAQK,OAAR,GAAkBA,OAAlB;;AAEA,mBAAOL,OAAP;AACD","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\r\nimport { ScrutinizerJSON, Handledata } from \"./reportData\";\r\nimport { reportTypes, reportDirection } from \"./reportTypes\";\r\n\r\nlet makescrutJSON = new ScrutinizerJSON();\r\nlet dataHandler = new Handledata();\r\n\r\nexport class GenericDatasource {\r\n  constructor(instanceSettings, $q, backendSrv, templateSrv, $http) {\r\n    this.type = instanceSettings.type;\r\n    this.url = instanceSettings.url + \"/fcgi/scrut_fcgi.fcgi\";\r\n    this.authToken = instanceSettings.jsonData[\"scrutinizerKey\"];\r\n    this.name = instanceSettings.name;\r\n    this.q = $q;\r\n    this.http = $http;\r\n    this.backendSrv = backendSrv;\r\n    this.templateSrv = templateSrv;\r\n    this.reportOptions = reportTypes;\r\n    this.reportDirections = reportDirection;\r\n    this.withCredentials = instanceSettings.withCredentials;\r\n    this.liveQuery = \"\";\r\n    this.headers = { \"Content-Type\": \"application/json\" };\r\n    if (\r\n      typeof instanceSettings.basicAuth === \"string\" &&\r\n      instanceSettings.basicAuth.length > 0\r\n    ) {\r\n      this.headers[\"Authorization\"] = instanceSettings.basicAuth;\r\n    }\r\n    this.runReport = false;\r\n\r\n    this.exporters = [];\r\n\r\n    this.filters = \"\";\r\n  }\r\n\r\n  query(options) {\r\n    let k = 0;\r\n    let datatoGraph = [];\r\n\r\n    this.runReport = false;\r\n\r\n    var query = this.buildQueryParameters(options);\r\n\r\n    this.liveQuery = query;\r\n    query.targets = query.targets.filter(t => !t.hide);\r\n\r\n    if (query.targets[0].target === undefined) {\r\n      return this.q.when({ data: [] });\r\n    }\r\n\r\n    if (this.templateSrv.getAdhocFilters) {\r\n      query.adhocFilters = this.templateSrv.getAdhocFilters(this.name);\r\n    } else {\r\n      query.adhocFilters = [];\r\n    }\r\n\r\n    let checkStart = query.targets.length - 1;\r\n    //make sure use has selected all of drop downs before running report\r\n    if (\r\n      (query.targets[checkStart].target !== undefined || \"Select Exporter\") &&\r\n      query.targets[checkStart].reportInterface !== \"Select Interface\" &&\r\n      query.targets[checkStart].reportDirection !== \"Select Direction\" &&\r\n      query.targets[checkStart].reportType !== \"Select Report\"\r\n    ) {\r\n      this.runReport = true;\r\n    }\r\n    //once all drop downs are selected, run the report. \r\n    if (this.runReport == true) {\r\n      return new Promise((resolve, reject) => {\r\n        for (let j = 0; j < query.targets.length; j++) {\r\n          let intervalTime = makescrutJSON.findtimeJSON(\r\n            this.authToken,\r\n            query.targets[j].reportType, //report type\r\n            options[\"range\"][\"from\"].unix(), //start time\r\n            options[\"range\"][\"to\"].unix(), //end time\r\n            query.targets[j].target, //ip address\r\n            query.targets[j].reportDirection, //report direction\r\n            query.targets[j].reportInterface, // exporter Interface\r\n            query.targets[j].reportFilters\r\n          );\r\n\r\n          this.doRequest({\r\n            url: `${this.url}`,\r\n            method: \"GET\",\r\n            params: intervalTime\r\n          }).then(response => {\r\n            let selectedInterval =\r\n              response.data[\"report_object\"].dataGranularity.used;\r\n\r\n            let scrutinizerJSON = makescrutJSON.reportJSON(\r\n              this.authToken,\r\n              query.targets[j].reportType, //report type\r\n              options[\"range\"][\"from\"].unix(), //start time\r\n              options[\"range\"][\"to\"].unix(), //end time\r\n              query.targets[j].target, //ip address\r\n              query.targets[j].reportDirection, //report direction\r\n              query.targets[j].reportInterface, // exporter Interface\r\n              query.targets[j].reportFilters\r\n            );\r\n\r\n            let scrutDirection = query.targets[j].reportDirection;\r\n\r\n            this.doRequest({\r\n              url: `${this.url}`,\r\n              method: \"GET\",\r\n              params: scrutinizerJSON\r\n            }).then(response => {\r\n              let formatedData = dataHandler.formatData(\r\n                response.data,\r\n                scrutDirection,\r\n                selectedInterval\r\n              );\r\n\r\n              datatoGraph.push(formatedData);\r\n              datatoGraph = [].concat.apply([], datatoGraph);\r\n\r\n              k++;\r\n              //incase user has multiple queries we want to make sure we have iterated through all of them before returning results.\r\n              if (k === query.targets.length) {\r\n                return resolve({ data: datatoGraph });\r\n              }\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  testDatasource() {\r\n    return this.doRequest({\r\n      url: `${this.url}`,\r\n      method: \"GET\",\r\n      params: {\r\n        rm: \"licensing\",\r\n        authToken: `${this.authToken}`\r\n      }\r\n    }).then(response => {\r\n      if (response.status === 200) {\r\n        return {\r\n          status: \"success\",\r\n          message: \"Data source is working\",\r\n          title: \"Success\"\r\n        };\r\n      }\r\n    });\r\n  }\r\n\r\n  findInterfaces(options, scope) {\r\n    let query = this.liveQuery;\r\n\r\n    if (query.targets[0].target != undefined) {\r\n      //determins which select you have clicked on.\r\n      let selectedIP = scope.ctrl.target.target;\r\n      return this.doRequest({\r\n        url: `${this.url}`,\r\n        method: \"GET\",\r\n        params: {\r\n          rm: \"status\",\r\n          action: \"get\",\r\n          view: \"topInterfaces\",\r\n          authToken: `${this.authToken}`,\r\n          session_state: {\r\n            client_time_zone: \"America/New_York\",\r\n            order_by: [],\r\n            search: [\r\n              {\r\n                column: \"exporter_search\",\r\n                value: `${selectedIP}`,\r\n                comparison: \"like\",\r\n                data: { filterType: \"multi_string\" },\r\n                _key: `exporter_search_like_${selectedIP}`\r\n              }\r\n            ],\r\n            query_limit: { offset: 0, max_num_rows: 50 },\r\n            hostDisplayType: \"dns\"\r\n          }\r\n        }\r\n      }).then(response => {\r\n        let data = [{ text: \"All Interfaces\", value: \"allInterfaces\" }];\r\n        let l = 0;\r\n        let jsonData = response.data;\r\n        for (l = 0; l < jsonData.rows.length; l++) {\r\n          data.push({\r\n            value: jsonData.rows[l][5].filterDrag.searchStr,\r\n            text: jsonData.rows[l][5].label\r\n          });\r\n        }\r\n\r\n        return data;\r\n      });\r\n    }\r\n  }\r\n\r\n  applyFilter(scope, refresh) {\r\n    this.filters = scope.ctrl.target.filters;\r\n    refresh.refresh();\r\n  }\r\n\r\n  getExporters(query, scope) {\r\n    if (scope.ctrl.target.refId === \"A\" && query === \"\") {\r\n      return this.doRequest({\r\n        url: `${this.url}`,\r\n        method: \"GET\",\r\n        params: {\r\n          rm: \"get_known_objects\",\r\n          type: \"devices\",\r\n          authToken: `${this.authToken}`\r\n        }\r\n      }).then(response => {\r\n        let exporterList = [{ text: \"All Exporters\", value: \"allExporters\" }];\r\n        for (let i = 0; i < response.data.length; i++) {\r\n          exporterList.push({\r\n            text: response.data[i][\"name\"],\r\n            value: response.data[i][\"ip\"]\r\n          });\r\n        }\r\n\r\n        this.exporters = exporterList;\r\n        return exporterList;\r\n      });\r\n    } else {\r\n      return this.exporters;\r\n    }\r\n  }\r\n\r\n  mapToTextValue(result) {\r\n    return _.map(result.data, (d, i) => {\r\n      if (d && d.text && d.value) {\r\n        return { text: d.text, value: d.value };\r\n      } else if (_.isObject(d)) {\r\n        return { text: d, value: i };\r\n      }\r\n\r\n      return { text: d, value: d };\r\n    });\r\n  }\r\n\r\n  doRequest(options) {\r\n    options.withCredentials = this.withCredentials;\r\n    options.headers = this.headers;\r\n\r\n    return this.backendSrv.datasourceRequest(options);\r\n  }\r\n\r\n  buildQueryParameters(options) {\r\n    options.targets = _.filter(options.targets, target => {\r\n      return target.target !== \"select metric\";\r\n    });\r\n\r\n    var targets = _.map(options.targets, target => {\r\n      return {\r\n        target: this.templateSrv.replace(\r\n          target.target,\r\n          options.scopedVars,\r\n          \"regex\"\r\n        ),\r\n        refId: target.refId,\r\n        hide: target.hide,\r\n        type: target.type || \"timeserie\",\r\n\r\n        reportType: this.templateSrv.replace(\r\n          target.report,\r\n          options.scopedVars,\r\n          \"regex\"\r\n        ),\r\n\r\n        reportDirection: this.templateSrv.replace(\r\n          target.direction,\r\n          options.scopedVars,\r\n          \"regex\"\r\n        ),\r\n\r\n        reportInterface: this.templateSrv.replace(\r\n          target.interface || \"Select Interface\",\r\n          options.scopedVars,\r\n          \"regex\"\r\n        ),\r\n\r\n        reportFilters: this.templateSrv.replace(\r\n          target.filters || \"No Filter\",\r\n          options.scopedVars,\r\n          \"regex\"\r\n        )\r\n      };\r\n    });\r\n\r\n    options.targets = targets;\r\n\r\n    return options;\r\n  }\r\n}\r\n"]}